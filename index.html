<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MorphCast Video Emotion Tracking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    video {
      width: 80%;
      height: auto;
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>Watch the Video and Track Your Emotions</h1>
  <button id="watchBtn">Watch Video</button>
  
  <video id="videoPlayer" controls>
    <source src="https://assets.homa-cloud.com/clicqla3j02wfyq01nkyf7621/853d663c-39ba-4755-bf72-1da193d2e2d4/HIR_C67_V4_WW_VID_1080x1920_33s.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <script src="https://sdk.morphcast.com/mphtools/v1.1/mphtools.js" data-config="cameraPrivacyPopup, compatibilityUI, compatibilityAutoCheck"></script>
  <script src="https://ai-sdk.morphcast.com/v1.16/ai-sdk.js"></script>
  <script src="https://sdk.morphcast.com/emotion-statistics/v1.0-beta/script.js"></script>

  <script>
    const watchBtn = document.getElementById('watchBtn');
    const videoPlayer = document.getElementById('videoPlayer');
    
    const statsConfig = {
      sendDatainterval: 5000,
      tickInterval: 1000,
      stopAfter: 7200000,
      licenseKey: "sk9bebf5467e79a53a382ee56f1293c7e03b406b94f0af"
    };
    
    const statisticsUploader = new MorphCastStatistics.StatisticsUploader(statsConfig);

    // Load MorphCast AI modules
    let morphcastInstance = null;

    CY.loader()
      .licenseKey("sk9bebf5467e79a53a382ee56f1293c7e03b406b94f0af")
      .addModule(CY.modules().FACE_AROUSAL_VALENCE.name, { smoothness: 0.70 })
      .addModule(CY.modules().FACE_EMOTION.name, { smoothness: 0.40 })
      .addModule(CY.modules().FACE_ATTENTION.name, { smoothness: 0.83 })
      .addModule(CY.modules().FACE_DETECTOR.name, { maxInputFrameSize: 320, smoothness: 0.83 })
      .addModule(CY.modules().ALARM_NO_FACE.name, { timeWindowMs: 10000, initialToleranceMs: 7000, threshold: 0.75 })
      .addModule(CY.modules().DATA_AGGREGATOR.name, { initialWaitMs: 2000, periodMs: 1000 })
      .load()
      .then(({ start, stop }) => {
        morphcastInstance = { start, stop };
      });

    // When the watch button is clicked
    watchBtn.addEventListener('click', async () => {
      if (morphcastInstance) {
        await morphcastInstance.start();
        await statisticsUploader.start();
      }
      
      videoPlayer.play(); // Play the video

      videoPlayer.onended = async () => {
        // Stop MorphCast once the video ends
        if (morphcastInstance) {
          await statisticsUploader.stop();
          await morphcastInstance.stop();
        }
        alert("Video ended. Emotion tracking stopped.");
      };
    });

    // Event listeners for emotion tracking results
    window.addEventListener(CY.modules().FACE_AROUSAL_VALENCE.eventName, (evt) => {
      console.log('FACE_AROUSAL_VALENCE result', evt.detail);
    });

    window.addEventListener(CY.modules().FACE_EMOTION.eventName, (evt) => {
      console.log('FACE_EMOTION result', evt.detail);
    });

    window.addEventListener(CY.modules().FACE_ATTENTION.eventName, (evt) => {
      console.log('FACE_ATTENTION result', evt.detail);
    });

    window.addEventListener(CY.modules().FACE_DETECTOR.eventName, (evt) => {
      console.log('FACE_DETECTOR result', evt.detail);
    });

    window.addEventListener(CY.modules().ALARM_NO_FACE.eventName, (evt) => {
      console.log('ALARM_NO_FACE result', evt.detail);
    });

    window.addEventListener(CY.modules().DATA_AGGREGATOR.eventName, (evt) => {
      console.log('DATA_AGGREGATOR result', evt.detail);
    });

    // Set the text for camera privacy
    MphTools.CameraPrivacyPopup.setText({
      "title": "Allow us to use your camera",
      "description": "This experience is designed to be viewed with your camera on. The next screen will ask your consent to access data from your camera.",
      "url": "https://YOUR_DOMAIN/privacy-policy"
    });
  </script>

</body>
</html>
